---
description: Voc√™ √© um engenheiro s√™nior .NET e tamb√©m um gerente t√©cnico disciplinado. Construa a API REST **pms-backend** do projeto **PathfinderManagementSoftware** em **ASP.NET Core .NET 8 (LTS)** com **EF Core (code-first)** e **PostgreSQL 16**.

globs:
  - "src/**/*.cs"
  - "tests/**/*.cs"
  - "*.csproj"
  - "*.sln"
  - "*.json"
  - "*.yml"
  - "*.yaml"
  - "*.md"
  - "*.sql"
  - "*.ps1"
  - "*.sh"
  - "Dockerfile*"
  - "docker-compose*.yml"
  - ".editorconfig"
  - "dotnet-tools.json"
  - "*.mdc"
alwaysApply: true
---

# üìã PMS Backend - Regras de Desenvolvimento

## üìë √çndice

- [üéØ Governan√ßa de MVPs](#governan√ßa-de-mvps)
- [üèóÔ∏è Arquitetura e Plataforma](#arquitetura-e-plataforma)
- [üîê Autentica√ß√£o e Autoriza√ß√£o](#autentica√ß√£o-e-autoriza√ß√£o)
- [üèõÔ∏è Hierarquia e Rela√ß√µes](#hierarquia-e-rela√ß√µes)
- [üë• Pessoas, Cargos e Regras](#pessoas-cargos-e-regras)
- [üìö Programa e Progresso](#programa-e-progresso)
- [üéâ Eventos e Participa√ß√µes](#eventos-e-participa√ß√µes)
- [üìä Relat√≥rios e Exporta√ß√µes](#relat√≥rios-e-exporta√ß√µes)
- [üîß Qualidade e Testes](#qualidade-e-testes)
- [üìà MVPs e Escopo](#mvps-e-escopo)
- [‚è≥ Status Pending e Onboarding](#status-pending-e-onboarding)
- [üöÄ Quick Reference](#quick-reference)

---

## üéØ Governan√ßa de MVPs

### ‚ö†Ô∏è SCOPE LOCK - OBRIGAT√ìRIO

- **Entregas por MVP** em fatias verticais
- **MVPs dispon√≠veis**: MVP-0 (N√∫cleo operacional), MVP-1 (Programa/Aprova√ß√µes/Investiduras), MVP-2 (Opera√ß√£o ampliada)
- **N√ÉO implementar** nada fora do MVP vigente
- Itens fora do escopo ‚Üí **OPEN_QUESTIONS** no **PROGRESS.md**
- **Crit√©rios de aceite** obrigat√≥rios para cada MVP
- **Relat√≥rio de aceite** em **ACCEPTANCE.md** com casos verificados
- **S√≥ avan√ßar** para pr√≥ximo MVP quando atual for **ACEITO** (flag "MVP-X: ACCEPTED")

### üìã Ordem de Execu√ß√£o Recomendada

1. **Backend** do MVP vigente
2. **Integra√ß√£o m√≠nima Frontend** do mesmo MVP
3. **Aceite** do MVP atual
4. **Pr√≥ximo MVP**

---

## üèóÔ∏è Arquitetura e Plataforma

### üéØ Fase e Contexto

- **Fase 1**: BACKEND (atual)
- **Fase 2**: FRONTEND React (consumir√° OpenAPI)
- **Gerar**: OpenAPI 3.1 (JSON e YAML) + client TypeScript (NSwag)
- **Habilitar**: CORS com exemplos no README

### üìÅ Estrutura de Diret√≥rios - CR√çTICO

**‚ö†Ô∏è IMPORTANTE**: A estrutura de diret√≥rios do backend foi reorganizada para monorepo:

- **Caminho correto da API**: `src/backend/Pms.Backend.Api/`
- **Comando para executar**: `cd src/backend/Pms.Backend.Api && dotnet run`
- **Solu√ß√£o**: `src/backend/Pms.Backend.sln`
- **Docker context**: `src/backend/` (conforme docker-compose.yml)

**üìù Regra de Atualiza√ß√£o**: Sempre que houver altera√ß√£o na estrutura de diret√≥rios, esta se√ß√£o DEVE ser atualizada imediatamente para evitar confus√£o e erros de execu√ß√£o.

### üõ†Ô∏è Stack Tecnol√≥gica

| Componente      | Tecnologia               | Vers√£o       |
| --------------- | ------------------------ | ------------ |
| Framework       | ASP.NET Core             | .NET 8 (LTS) |
| Banco de Dados  | PostgreSQL               | 16           |
| ORM             | EF Core                  | Code-first   |
| Documenta√ß√£o    | Swashbuckle              | OpenAPI 3.1  |
| Valida√ß√£o       | FluentValidation         | HTTP 422     |
| Testes          | xUnit + FluentAssertions | -            |
| Observabilidade | Serilog + OpenTelemetry  | -            |

### üèõÔ∏è Arquitetura Clean

```
Pms.Backend.sln
‚îú‚îÄ‚îÄ Pms.Backend.Domain/          # Entities, ValueObjects, DomainServices, Events
‚îú‚îÄ‚îÄ Pms.Backend.Application/     # UseCases, DTOs, Validation, Mappings
‚îú‚îÄ‚îÄ Pms.Backend.Infrastructure/  # EF Core, Npgsql, Repos, Migrations, Seeds
‚îú‚îÄ‚îÄ Pms.Backend.Api/            # Controllers, Auth, Swagger, CORS
‚îî‚îÄ‚îÄ Pms.Backend.Tests/          # Unit, Integration, Acceptance Tests
```

### üéØ Regras de Controllers - OBRIGAT√ìRIO

**Controllers devem ser "thin" e seguir estas regras:**

- **‚ùå PROIBIDO**: try/catch em controllers
- **‚ùå PROIBIDO**: l√≥gica de decis√£o em controllers
- **‚ùå PROIBIDO**: valida√ß√£o de ModelState em controllers
- **‚úÖ OBRIGAT√ìRIO**: Apenas logging de entrada e chamada para service
- **‚úÖ OBRIGAT√ìRIO**: Retornar diretamente o resultado do service
- **‚úÖ OBRIGAT√ìRIO**: Tratamento de erros centralizado via middleware
- **‚úÖ OBRIGAT√ìRIO**: Usar `[Route("pms-loc/[controller]")]` para rotas (padr√£o do projeto)
- **‚ùå PROIBIDO**: Rotas customizadas como `[Route("[controller]")]` ou `[Route("api/[controller]")]`
- **‚úÖ OBRIGAT√ìRIO**: Retornar `IActionResult` em todos os endpoints
- **‚úÖ OBRIGAT√ìRIO**: Usar `BaseResponse<T>` para encapsular dados de resposta
- **‚úÖ OBRIGAT√ìRIO**: Herdar de `BaseController` para usar m√©todos `ProcessResponse`
- **‚úÖ OBRIGAT√ìRIO**: Incluir `CancellationToken` em todos os m√©todos ass√≠ncronos
- **‚úÖ OBRIGAT√ìRIO**: Usar `[ProducesResponseType]` para documentar Swagger

**Exemplo de Controller CORRETO:**

```csharp
[ApiController]
[Route("pms-loc/members")]
public class MemberController : BaseController
{
    [HttpGet]
    [ProducesResponseType(typeof(BaseResponse<MemberListResponseDto>), StatusCodes.Status200OK)]
    [ProducesResponseType(typeof(BaseResponse<object>), StatusCodes.Status400BadRequest)]
    public async Task<IActionResult> GetMembers(
        [FromQuery] GetMembersRequestDto request,
        CancellationToken cancellationToken = default)
    {
        _logger.LogInformation("Listando membros com filtros: {Filters}", request);

        var result = await _memberService.GetMembersAsync(request, cancellationToken);
        return ProcessResponse(result);
    }
}
```

**Exemplo de Controller INCORRETO:**

```csharp
[ApiController]
[Route("[controller]")] // ‚ùå Rota sem prefixo pms-loc proibida
public class MemberController : ControllerBase // ‚ùå Deve herdar de BaseController
{
    [HttpGet]
    public async Task<ActionResult<ApiResponse<MemberListResponseDto>>> GetMembers( // ‚ùå Deve retornar IActionResult
        [FromQuery] GetMembersRequestDto request) // ‚ùå Falta CancellationToken
    {
        try // ‚ùå Try/catch proibido
        {
            if (!ModelState.IsValid) // ‚ùå Valida√ß√£o de ModelState proibida
            {
                return BadRequest(new ApiResponse<MemberListResponseDto>
                {
                    Success = false,
                    Message = "Dados inv√°lidos"
                });
            }

            var result = await _memberService.GetMembersAsync(request);
            return Ok(result); // ‚ùå Deve usar ProcessResponse
        }
        catch (Exception ex) // ‚ùå Try/catch proibido
        {
            _logger.LogError(ex, "Erro ao listar membros");
            return StatusCode(500, new ApiResponse<MemberListResponseDto>
            {
                Success = false,
                Message = "Erro interno do servidor"
            });
        }
    }
}
```

### ‚öôÔ∏è Configura√ß√µes de Qualidade

- **TargetFramework**: net8.0 (LTS)
- **Banco**: PostgreSQL 16 (Npgsql) - sem SQLite
- **√çndices parciais** para "unicidade quando ativo"
- **Observabilidade**: Serilog + CorrelationId + OpenTelemetry (DEV)
- **Valida√ß√µes**: FluentValidation ‚Üí HTTP 422
- **Qualidade**: analyzers + warnings-as-errors + nullable enable
- **CI**: GitHub Actions (build+test + verifica√ß√£o de migra√ß√µes)

---

## üîê Autentica√ß√£o e Autoriza√ß√£o

### üîë JWT e Claims

```json
{
  "sub": "user-id",
  "email": "user@example.com",
  "roles": ["Director", "Regional"],
  "scopes": ["Club:123", "Region:456"],
  "exp": 1234567890
}
```

### üë§ Sistema de Usu√°rios

- **E-mail √∫nico global** (inclusive para arquivados)
- **Senha**: Argon2/BCrypt com hist√≥rico de 5 senhas
- **Sem registro p√∫blico** no MVP
- **Cria√ß√£o via** `POST /members`
- **Seed SystemAdmin** com token de ativa√ß√£o

### üîÑ Fluxo de Ativa√ß√£o

1. **Convite** ‚Üí token 24h
2. **Ativa√ß√£o** ‚Üí `/auth/activate`
3. **Esqueci senha** ‚Üí reset via token

### üîì Release de E-mail

**Apenas SystemAdmin/Regional‚Üë**:

1. Confirma√ß√£o + motivo
2. Mascarar e-mail no registro antigo
3. Remover UserCredential
4. Logar em SecurityAuditLog

---

## üèõÔ∏è Hierarquia e Rela√ß√µes

### üìä Cadeia Hier√°rquica

```
Divis√£o ‚Üí Uni√£o ‚Üí Associa√ß√£o ‚Üí Regi√£o ‚Üí Distrito ‚Üí Clube ‚Üí Unidade ‚Üí Membro
```

### üîó Rela√ß√µes Obrigat√≥rias

- **Clube ‚Üî Igreja**: 1:1 obrigat√≥rio
- **Igreja**: CEP √∫nico global
- **Cada n√≠vel**: 1 pai, 0..N filhos
- **Clube**: pertence a 1 Distrito (obrigat√≥rio)

### üè∑Ô∏è C√≥digos e CodePath

| Campo      | Regras                                   | Exemplo                      |
| ---------- | ---------------------------------------- | ---------------------------- |
| `Code`     | ‚â§5 chars, UPPERCASE A-Z0-9, manual       | `DSA`, `UCB`                 |
| `CodePath` | ‚â§60 chars, somente leitura, concatena√ß√£o | `DSA.UCB.APL.APL3RT.DVM.PAC` |

### üîÑ Mudan√ßa de Pai

- **Recalcular** `CodePath` em cascata
- **Mesma transa√ß√£o** para consist√™ncia
- **Unicidade**: Code √∫nico por n√≠vel, CodePath √∫nico global

---

## üë• Pessoas, Cargos e Regras

### üëî Pap√©is por N√≠vel

#### üèõÔ∏è Lideran√ßa Superior

- **Uni√£o**: 1 Pastor da Uni√£o (‚â•18, Batismo+Len√ßo)
- **Associa√ß√£o**: 1 Pastor da Associa√ß√£o (‚â•18, Batismo+Len√ßo)
- **Regi√£o**: 1 Pastor da Regi√£o (‚â•18, Batismo+Len√ßo) + 1 Regional (‚â•18)

#### üèòÔ∏è Lideran√ßa Local

- **Distrito**: 1 Distrital (‚â•18)
- **Clube**: Diretoria com regras espec√≠ficas
- **Unidade**: Conselheiros e juvenis

### üèõÔ∏è Diretoria do Clube

| Cargo                | Quantidade   | Idade | G√™nero    | Requisitos    |
| -------------------- | ------------ | ----- | --------- | ------------- |
| Diretor              | 1            | ‚â•18   | -         | Batismo+Len√ßo |
| Diretores Associados | ‚â§2           | ‚â•16   | Distintos | -             |
| Secret√°rio           | 1            | ‚â•16   | -         | -             |
| Anci√£o               | 1 (opcional) | ‚â•18   | -         | Batismo+Len√ßo |
| Capel√£o              | 1 (opcional) | ‚â•18   | -         | Batismo+Len√ßo |
| Instrutores          | N            | ‚â•16   | -         | -             |

### üö´ Regras de Ac√∫mulo

- **Sem ac√∫mulo** de cargos de diretoria no Clube
- **Instrutor incluso** na regra de ac√∫mulo
- **Requisitos espirituais**: Batismo + Len√ßo para toda lideran√ßa

### üîÑ Promo√ß√µes e Baixas

#### Regional/Distrital/Pastores

- **Proibido**: membership de clube e v√≠nculo de unidade
- **Ao assumir**: encerrar memberships/cargos de Clube/Unidade
- **Ao deixar**: servi√ßo "associar a um clube"

#### Rebaixamento

- **Regional ‚Üî Distrital**: cargo anterior √© perdido (mant√©m hist√≥rico)

### üë• Delegado de Aprova√ß√£o

```csharp
ApprovalDelegate {
    Role,           // Cargo que pode delegar
    ScopeType,      // Tipo do escopo
    ScopeId,        // ID do escopo
    Start,          // Data in√≠cio
    End,            // Data fim
    DelegatedToAssignmentId  // Para quem delegou
}
```

**Regras**:

- Regional pode delegar a Distrital da sua Regi√£o
- Ou a Regional de outra Regi√£o
- **Conflito de interesse**: n√£o aprova pr√≥prio progresso nem de filho

---

## üìö Programa e Progresso

### üéì Classes Regulares

| Classe        | Idade | Ordem |
| ------------- | ----- | ----- |
| Amigo         | 10    | 1     |
| Companheiro   | 11    | 2     |
| Pesquisador   | 12    | 3     |
| Pioneiro      | 13    | 4     |
| Excursionista | 14    | 5     |
| Guia          | 15    | 6     |

### üèÜ Classes Avan√ßadas

- **Podem iniciar** a qualquer momento
- **S√≥ concluem** ap√≥s a respectiva regular estar **Conclu√≠da**

### üëë Lideran√ßa

| Cargo                 | Idade In√≠cio | Idade Investidura | Pr√©-requisitos       |
| --------------------- | ------------ | ----------------- | -------------------- |
| L√≠der                 | ‚â•16          | ‚â•18               | Regulares conclu√≠das |
| L√≠der Master          | -            | -                 | Requer L√≠der         |
| L√≠der Master Avan√ßado | -            | -                 | Requer L√≠der Master  |

**Regra**: N√£o √© permitido pular regulares e ir direto a L√≠der

### üèÖ Especialidades

#### Categorias Can√¥nicas

- **AD, HM, AA, AM, AP, AR, CS, EN, HD**
- **Chave**: Acronym (‚â§3 alfanum.) + Code (1..999)
- **Exibi√ß√£o**: D3 (001, 010, 245)
- **M√∫ltiplas**: mesmo membro pode ter v√°rias da mesma categoria

### üéñÔ∏è Mestrados

- **Entidade pr√≥pria** (`Mastery`)
- **Independentes** de classes
- **Requisitos**: AND/OR/MIN-OF-N por especialidades
- **Hist√≥rico √∫nico**: n√£o repetir itens j√° Conclu√≠dos

---

## üéâ Eventos e Participa√ß√µes

### üìÖ Organiza√ß√£o

- **Qualquer n√≠vel**: Divis√£o/Uni√£o/Associa√ß√£o/Regi√£o/Distrito/Clube
- **Registrar**: `OrganizerLevel` e `OrganizerId`

### ‚úÖ Elegibilidade Multi-dia

- **Membro ativo** em toda a janela (Start‚ÜíEnd)
- **Clube inativo**: membros **n√£o** podem participar
- **Lideran√ßas sem membership**: podem participar

### üí∞ Taxas

- **FeeAmount?/FeeCurrency?** por evento
- **Default**: gratuito
- **Moeda global**: BRL (configur√°vel)

---

## üìä Relat√≥rios e Exporta√ß√µes

### üìà Exporta√ß√µes CSV (Diretor)

| Endpoint                                                   | Descri√ß√£o          | Formato    |
| ---------------------------------------------------------- | ------------------ | ---------- |
| `/reports/members.csv?clubId=...`                          | Membros do clube   | UTF-8, `;` |
| `/reports/timeline.csv?memberId=...`                       | Timeline do membro | UTF-8, `;` |
| `/reports/participations.csv?clubId=...&start=...&end=...` | Participa√ß√µes      | UTF-8, `;` |

### üìÖ Datas

- **Persistir**: UTC
- **Exibir/Validar**: America/Sao_Paulo (Hor√°rio de Bras√≠lia)

---

## üîß Qualidade e Testes

### üß™ Cobertura M√≠nima

- **Domain + Application**: ‚â•70%
- **Total**: ‚â•60%

### ‚úÖ Casos de Teste Obrigat√≥rios

#### Membership

- [ ] Membership √∫nica (e "0 ativa" para Regional/Distrital/Pastores)
- [ ] Regra 1¬∫/06
- [ ] Capacidade de unidade
- [ ] 0/>1 op√ß√µes ‚Üí tarefas/422

#### Diretoria

- [ ] 1 Diretor
- [ ] Associados (m√°x. 2, g√™neros distintos)
- [ ] Sem ac√∫mulo
- [ ] Clube sem diretor ‚Üí `IsActive=false` + bloqueios

#### Aprova√ß√µes

- [ ] Cadeias de aprova√ß√£o (pular Distrital)
- [ ] Conflito/auto/familiar ‚Üí pular
- [ ] Delegado de aprova√ß√£o

#### Outros

- [ ] Gating por Len√ßo
- [ ] Investidura (testemunhas ativas na data/escopo)
- [ ] CodePath recalculado em cascata
- [ ] Clube inativo bloqueia eventos/progressos

### üîí Gating por Len√ßo (Scarf)

#### Aplica√ß√£o

- **Escopo**: Classes (regulares e avan√ßadas), Especialidades e Mestrados
- **Endpoints bloqueados sem len√ßo**: `/start`, `/patch` (updates), `/submit`, `/approve`
- **Erro**: 422 ScarfRequired
- **Leituras (GET)**: N√£o s√£o bloqueadas

#### Valida√ß√£o

- **Campo**: `Member.ScarfInvested = true`
- **Mensagem**: "Opera√ß√£o '{operationType}' requer investidura de len√ßo. O membro deve ter recebido o len√ßo antes de iniciar progressos."

### üéñÔ∏è Investiduras - Testemunhas

#### Estrutura InvestitureWitness

```csharp
InvestitureWitness {
    Type,                    // Structured | Text
    MemberId?,               // quando Structured
    RoleSnapshot?,           // quando Structured { Role, ScopeType, ScopeCodePath, EffectiveDate }
    NameText?,               // quando Text (VARCHAR(200))
    RoleText?,               // quando Text (VARCHAR(100))
    OrgText?,                // quando Text (VARCHAR(120))
}
```

#### Regras de Valida√ß√£o

- **‚â•1 testemunha** obrigat√≥ria (qualquer Type) em toda investidura
- **Lideran√ßa**: obrigat√≥rio "Pastor da Associa√ß√£o" (Structured ou Text)
- **Fallback**: "Pastor da Uni√£o" se "Pastor da Associa√ß√£o" indispon√≠vel
- **Override admin**: se nenhum dos dois for vi√°vel, exigir motivo + Task "Validar Investidura de Lideran√ßa (sem Pastor)"
- **Aprovador ‚â† Testemunha**: permitido (n√£o no mesmo ato de auto-testemunho)

### üè¢ Clube Inativo - Bloqueios

#### Fonte de Verdade

- **Campo**: `Club.IsActive` (persistido)
- **Atualiza√ß√£o**: eventos de dom√≠nio
  - `false` quando n√£o existir Diretor ativo
  - `true` ao nomear novo Diretor

#### Bloqueios (IsActive = false)

**No escopo do clube:**

- Cria√ß√£o/altera√ß√£o de eventos
- Cria√ß√£o/altera√ß√£o de cargos
- Cria√ß√£o/altera√ß√£o de memberships
- Aprova√ß√µes
- Investiduras

**Membros com membership no clube:**

- Participa√ß√£o em eventos
- Progresso (start/update/submit/approve)
- Investiduras

**Exce√ß√µes:**

- Regionais/Distritais/Pastores (sem membership de clube) continuam aptos em seus escopos
- Podem participar de eventos
- Aprova√ß√µes relativas a membros do clube inativo permanecem bloqueadas

#### Tarefas Autom√°ticas

- "Reativar Clube (nomear Diretor)"
- "Ofertar Realoca√ß√£o" conforme regras j√° definidas

### üîí Seguran√ßa

- **Pol√≠tica de senha**: min 10; 1 mai√∫scula; 1 min√∫scula; 1 d√≠gito
- **Hist√≥rico**: 5 senhas
- **Lockout**: 5/15‚Üí15 (configur√°vel)
- **Rate limit**: global habilitado (por IP e por usu√°rio)

---

## üìà MVPs e Escopo

### üéØ MVP-0: N√∫cleo Operacional

**Escopo**:

- Plataforma/seguran√ßa
- Hierarquia+igrejas (Code/CodePath)
- Membros (‚â•10, batismo)
- Convite/ativa√ß√£o
- Len√ßo
- Clubes/unidades/membership
- Cargos/sem ac√∫mulo
- Delegado
- Eventos (eligibilidade multi-dia + regras opcionais)
- Timeline b√°sica
- CSV Director

### üéâ Sistema de Eventos - Regras Detalhadas

#### CO-ORGANIZADORES (MVP-2)

- **OfficialEvent.CoHosts[]** (opcional; apenas leitura no MVP):
  - Item: `{ Level: EventLevel, Id: Guid }` // ex.: `{ Level:"Club", Id:"<CLUB_ID>" }`
  - Host continua sendo `OrganizerLevel/OrganizerId` (fonte de verdade)
  - CoHosts ampliam o cr√©dito de organiza√ß√£o (exibi√ß√£o, relat√≥rios), N√ÉO alteram elegibilidade por si s√≥
- Visibilidade/inscri√ß√£o continuam sendo definidas por `AudienceMode/AllowList/Visibility`
- DTO inclui `CoHosts[]` quando a feature estiver ativa (flag futura)

#### REGRAS OPCIONAIS POR EVENTO (MVP-ready, por√©m desativ√°veis por flag)

- **OfficialEvent.MinAge?** (int) e **MaxAge?** (int)
  - Avalia√ß√£o em America/Sao_Paulo, idade calculada na DATA DE IN√çCIO do evento
  - Inclusivo nas bordas: `MinAge ‚â§ idade ‚â§ MaxAge`
  - Falha de inscri√ß√£o: `422 AgeNotEligible`
- **OfficialEvent.RequiresMedicalInfo** (bool, default=false)
  - Se true, bloquear inscri√ß√£o se o membro n√£o possuir os campos m√≠nimos definidos do MedicalInfo
  - Falha: `422 MedicalInfoRequired`
- **OfficialEvent.RequiresScarfInvested** (bool, default=false)
  - Se true, exigir investidura de len√ßo para inscrever (n√£o ligado a progresso)
  - Falha: `422 ScarfRequiredForEvent`
- **Feature flags sugeridas**:
  - `Events.MinMaxAge.Enabled` (default=false)
  - `Events.MedicalInfo.Required.Enabled` (default=false)
  - `Events.RequiresScarf.Enabled` (default=false)

#### VISIBILIDADE √ó INSCRI√á√ÉO (clareza de pap√©is)

- **Visibility** controla QUEM V√ä o evento no feed/busca:
  - `Public | LeadersOnly | DirectorsOnly | CustomRoles`
- **AudienceMode/AllowList** controla QUEM PODE SE INSCREVER:
  - `AudienceMode`: `Subtree | HostOnly | CustomAllowList`
  - `AllowLeadersAboveHost` (bool, default=true)
  - `AllowList` por n√≠vel (`Clubs[]`, `Districts[]`, `Regions[]`, `Associations[]`, `Unions[]`, `Divisions[]`)

#### M√âTRICAS (expostas nos DTOs e endpoints)

- Campos no DTO de evento (e em `/events`, `/dashboard`, `/events/{id}/metrics`):
  - `RegisteredCount`, `WaitlistedCount`, `CheckedInCount`, `Capacity`, `CapacityRemaining`
- Atualiza√ß√£o denormalizada em: create registration, cancel registration, promote waitlist, check-in (idempotente; transa√ß√£o)

#### MUDAN√áA DE AUDI√äNCIA (controle e comunica√ß√£o)

- Altera√ß√µes em `AudienceMode/AllowList/AllowLeadersAboveHost` AP√ìS o in√≠cio das inscri√ß√µes:
  - Exigir endpoint dedicado: `PATCH /events/{id}/audience` (com valida√ß√µes e "dry-run" opcional)
  - Criar automaticamente:
    - News de "AudienceUpdated" (reason + diff)
    - Task "Revisar Mudan√ßa de Audi√™ncia" para respons√°veis do escopo do Host
  - Regra de conviv√™ncia (default): inscri√ß√µes existentes s√£o preservadas ("grandfathered"); novas inscri√ß√µes seguem as NOVAS regras
  - Se a mudan√ßa RESTRINGIR e houver inscritos fora do novo p√∫blico:
    - Retornar WARNING no payload de PATCH (listagem amostral dos afetados)
    - Oferecer par√¢metro opcional `hardEnforce=true` (MVP-2) para bloqueio futuro e gera√ß√£o de Tasks de contato/cancelamento (sem auto-cancel no MVP)
- Mudan√ßas cr√≠ticas (ex.: alternar Subtree‚ÜîHostOnly) antes do RegistrationOpenAtUtc: permitidas sem News/Task

#### TESTES (adi√ß√µes)

- Inscri√ß√£o falha por `AgeNotEligible` quando MinAge/MaxAge ativos
- `RequiresMedicalInfo=true` bloqueia inscri√ß√£o quando faltar campos m√≠nimos
- `RequiresScarfInvested=true` bloqueia inscri√ß√£o sem len√ßo
- `PATCH /events/{id}/audience` com inscri√ß√µes j√° abertas: gera News + Task e preserva inscri√ß√µes existentes
- CoHosts aparecem no DTO quando ativados; n√£o alteram elegibilidade por si s√≥

#### NOTAS

- Persistir todos os hor√°rios em UTC; validar/exibir em America/Sao_Paulo
- MinAge/MaxAge consideram idade completa na data de in√≠cio (BRT)

### üéØ MVP-1: Programa/Aprova√ß√µes/Investiduras

**Escopo**:

- Categorias/especialidades/classes/mestrados
- Progressos (status, gating len√ßo)
- Cadeias (pulos/Delegado/Conflito)
- Reprova√ß√£o/reabertura
- Investiduras (testemunhas ativas)

### üéØ MVP-2: Opera√ß√£o Ampliada

**Escopo**:

- Relat√≥rios ampliados
- Caches opcionais
- Webhooks/notifica√ß√µes
- Anexos bin√°rios (S3/local)
- Rate-limit por papel

---

## ‚è≥ Status Pending e Onboarding

### üìä Member Status

- **Pending**: Membro rec√©m-cadastrado com dados incompletos
- **Active**: Membro com dados completos e ativo
- **Archived**: Membro arquivado/inativo

### üîÑ Activation Checklist (MVP)

**Crit√©rios para ativa√ß√£o autom√°tica (Pending ‚Üí Active)**:

- ‚úÖ **Address completo**: zipCode, street, number, city, state
- ‚úÖ **Contact Email**: presente (do convite)
- ‚úÖ **Mobile recomendado**: n√£o obrigat√≥rio no MVP

### üö´ Operation Checklist

**N√£o afeta status, mas bloqueia opera√ß√µes de neg√≥cio**:

- ‚úÖ **ScarfInvestiture**: requerido para progress (classes/especialidades/mestrados)
- ‚úÖ **BaptismValidComputed**: true AND no active censure AND ScarfInvested = true para leadership

### üîê Login e Permiss√µes

#### Status Pending

- ‚úÖ **Login permitido**: JWT emitido normalmente
- ‚ùå **Escritas de dom√≠nio bloqueadas**: 403 MemberPending
- ‚úÖ **Endpoints /me/**: permitidos para completar cadastro

#### Status Active

- ‚úÖ **Todas as opera√ß√µes**: permitidas conforme permiss√µes

### üìù Login Response Structure

```json
{
  "token": "jwt_token_here",
  "member": {
    "id": "uuid",
    "status": "Pending|Active|Archived"
  },
  "pending": {
    "activationRequired": ["Address", "ContactEmail"],
    "operationRequired": ["ScarfInvestiture", "BaptismInfo"],
    "optional": ["MedicalInfo"],
    "blockingWrites": true
  }
}
```

**Regras do Login Response**:

- Chaves de "pending" **SEMPRE em ingl√™s**
- JWT permanece enxuto (sub, email, name, roles[], scopes[], exp)
- **N√ÉO incluir** "pending" no token JWT

### üë§ Create Member - Investidura Opcional

```json
{
  "firstName": "string",
  "lastName": "string",
  "dateOfBirth": "datetime",
  "gender": "enum",
  "cpf": "string",
  "rg": "string",
  "addressInfo": {
    /* CreateMemberAddressDto */
  },
  "loginInfo": {
    /* CreateMemberLoginInfoDto */
  },
  "contacts": [
    /* CreateMemberContactDto[] */
  ],
  "baptismInfo": {
    /* CreateMemberBaptismInfoDto - opcional */
  },
  "medicalInfo": {
    /* CreateMemberMedicalInfoDto - opcional */
  },
  "initialScarfInvestiture": {
    /* InvestitureDto - opcional */
  }
}
```

**Regras de Cria√ß√£o**:

- Valida√ß√£o de CPF e Email √∫nicos antes da cria√ß√£o
- Idade m√≠nima: 10 anos (baseado em 1¬∫ de junho do ano vigente)
- Dados m√≠nimos: FirstName, LastName, DateOfBirth, Gender, CPF, RG
- Address: zipCode, street, number, neighborhood, city, state (obrigat√≥rio)
- LoginInfo: email, password (obrigat√≥rio)
- Contacts: pelo menos 1 contato Mobile (obrigat√≥rio)
- Email do LoginInfo vira contato Email principal automaticamente

### üö® Error Codes

| C√≥digo | Significado                       | Uso                                            |
| ------ | --------------------------------- | ---------------------------------------------- |
| 403    | MemberPending                     | Tenta opera√ß√£o de dom√≠nio com status Pending   |
| 422    | ScarfRequired                     | Progresso sem len√ßo                            |
| 422    | RequisitosEspirituaisNaoAtendidos | Lideran√ßa sem batismo v√°lido/len√ßo/sem censura |

### üîÑ Ativa√ß√£o Autom√°tica

- **Idempotente**: verifica√ß√£o cont√≠nua do activation checklist
- **Autom√°tica**: promo√ß√£o para Active quando crit√©rios atendidos
- **Logs**: registrar mudan√ßas de status para auditoria

---

## üöÄ Quick Reference

### üîó Endpoints Principais

#### Autentica√ß√£o

- `POST /auth/invite` - Convite de usu√°rio
- `POST /auth/activate` - Ativa√ß√£o de conta
- `POST /auth/forgot-password` - Esqueci senha
- `POST /auth/reset-password` - Reset de senha

#### Membros

- `POST /members` - Criar membro completo (‚â•10 anos, com sub-objetos)
- `GET /members/me` - Dados do pr√≥prio membro (permitido para Pending)
- `PUT /members/me` - Atualizar dados do pr√≥prio membro (permitido para Pending)
- `POST /members/{id}/memberships` - Criar membership
- `POST /memberships/{id}/close` - Encerrar membership

#### Cargos

- `POST /assignments` - Criar cargo
- `POST /assignments/{id}/close` - Encerrar cargo
- `POST /assignments/associate-to-club` - Associar a clube

#### Progresso

- `POST /members/{id}/classes/{classId}/start` - Iniciar classe
- `PATCH /members/{id}/classes/{classId}` - Atualizar progresso
- `POST /progress/{itemType}/{itemId}/approve` - Aprovar progresso

### üìä C√≥digos de Status

| C√≥digo | Significado                       | Uso                                                    |
| ------ | --------------------------------- | ------------------------------------------------------ |
| 200    | OK                                | Sucesso                                                |
| 201    | Created                           | Cria√ß√£o bem-sucedida                                   |
| 400    | Bad Request                       | Dados inv√°lidos                                        |
| 401    | Unauthorized                      | N√£o autenticado                                        |
| 403    | Forbidden                         | Sem permiss√£o                                          |
| 403    | MemberPending                     | Membro com status Pending tentando opera√ß√£o de dom√≠nio |
| 404    | Not Found                         | Recurso n√£o encontrado                                 |
| 422    | Unprocessable Entity              | Viola√ß√£o de regra de neg√≥cio                           |
| 422    | ScarfRequired                     | Progresso sem len√ßo                                    |
| 422    | RequisitosEspirituaisNaoAtendidos | Lideran√ßa sem batismo v√°lido/len√ßo/sem censura         |
| 500    | Internal Server Error             | Erro interno                                           |

### üîß Feature Flags

| Flag                  | Default | Descri√ß√£o                  |
| --------------------- | ------- | -------------------------- |
| `Attachments.Enabled` | false   | Anexos bin√°rios (S3/local) |
| `Redis.Enabled`       | false   | Cache Redis                |
| `Jobs.Enabled`        | true    | Jobs de realoca√ß√£o         |
| `Exports.Enabled`     | true    | Exporta√ß√µes CSV            |
| `RateLimit.ByRole`    | false   | Rate limit por papel       |

---

## ü©π PATCH ‚Äî Dashboard, Eventos por Hierarquia e Edi√ß√£o de Dados (MVP0)

> **Incorpora√ß√£o:** anexar este bloco ao final do arquivo `.mdc` existente.  
> **Objetivo:** definir regras de backend para Dashboard, eventos hier√°rquicos e edi√ß√£o de dados pessoais.

### 1) Dashboard ‚Äî APIs e Endpoints
- **GET /dashboard** - Dados da dashboard por papel do usu√°rio
  - **Response**: KPIs agregados, se√ß√µes espec√≠ficas por papel, filtros persistentes
  - **Escopo**: baseado no papel (clube/distrito/regi√£o/global)
  - **Performance**: cache de 5 minutos para KPIs, 1 minuto para dados din√¢micos
- **GET /dashboard/kpis** - KPIs espec√≠ficos com drill-down
  - **Query params**: per√≠odo, unidade, status, papel
  - **Response**: dados agregados sem PII individual
- **GET /dashboard/sections** - Se√ß√µes espec√≠ficas por papel
  - **Response**: convites pendentes, aprova√ß√µes, capacidades, eventos pr√≥ximos

### 2) Eventos por Hierarquia ‚Äî Backend
- **GET /events/hierarchy** - Eventos do encadeamento hier√°rquico do usu√°rio
  - **Regra**: Unidade ‚Üí Clube ‚Üí Distrito ‚Üí Regi√£o ‚Üí Associa√ß√£o ‚Üí Uni√£o
  - **Query params**: n√≠vel, per√≠odo, elegibilidade
  - **Response**: eventos ordenados cronologicamente, badges de elegibilidade
- **GET /events/eligibility/{eventId}** - Verificar elegibilidade do usu√°rio
  - **Response**: Eleg√≠vel/Pendente/Ineleg√≠vel com motivos
- **POST /events/{eventId}/register** - Inscri√ß√£o em evento
  - **Valida√ß√µes**: elegibilidade, capacidade, regras do evento
- **GET /events/{eventId}/participants** - Participantes (por papel)
  - **Admin/Regional/Distrital**: vis√£o agregada sem PII
  - **Diretor/Secret√°rio**: lista completa do clube

### 3) Edi√ß√£o de Dados Pessoais ‚Äî Regras de Backend
- **PUT /members/{id}/personal-data** - Edi√ß√£o de dados pessoais
  - **Valida√ß√µes RBAC**: usu√°rio pr√≥prio ou diretor/secret√°rio do clube
  - **Campos edit√°veis**: nome social, contatos, endere√ßo, foto
  - **Campos restritos**: CPF, data nascimento (n√£o edit√°veis no MVP0)
- **PUT /members/{id}/contacts** - Edi√ß√£o de contatos
  - **Valida√ß√µes**: unicidade de email/telefone, verifica√ß√£o
  - **Auditoria**: log de altera√ß√µes de contato prim√°rio
- **GET /members/{id}/sensitive-data** - Dados sens√≠veis com auditoria
  - **Response**: dados mascarados, bot√£o "revelar" com auditoria
  - **Auditoria**: quem, quando, qual campo, requestId
- **PUT /members/{id}/medical-info** - Dados m√©dicos
  - **RBAC**: apenas o pr√≥prio membro pode editar
  - **Secret√°rio**: apenas leitura

### 4) Valida√ß√µes e Regras de Neg√≥cio
- **Unicidade**: CPF, email, telefone (global, incluindo arquivados)
- **Consist√™ncia hier√°rquica**: membro deve estar no mesmo clube da unidade
- **Capacidade de unidade**: verificar antes de associar membro
- **Elegibilidade de eventos**: idade, cargo, sexo, investidura de len√ßo
- **Auditoria de dados sens√≠veis**: log completo de visualiza√ß√µes

### 5) C√≥digos de Erro Adicionais
| C√≥digo | Significado                       | Uso                                                    |
| --- | --- | --- |
| 403    | DataEditNotAllowed                | Tentativa de editar dados restritos                    |
| 422    | DataValidationFailed              | Valida√ß√£o de dados pessoais falhou                     |
| 422    | ContactAlreadyExists              | Email/telefone j√° existe em outro membro               |
| 422    | EventNotEligible                  | Membro n√£o eleg√≠vel para o evento                      |
| 422    | UnitCapacityExceeded              | Unidade sem capacidade dispon√≠vel                      |

### 6) Performance e Cache
- **Dashboard KPIs**: cache de 5 minutos (Redis se habilitado)
- **Eventos hier√°rquicos**: cache de 2 minutos
- **Dados de membros**: cache de 1 minuto para dados n√£o sens√≠veis
- **Dados sens√≠veis**: sem cache, sempre fresh

---

## üìù Notas Importantes

### ‚ö†Ô∏è Orienta√ß√µes Finais

- **Em caso de ambiguidade**: N√ÉO implemente
- **Registre** em OPEN_QUESTIONS no PROGRESS.md
- **N√ÉO avance** para pr√≥ximo MVP sem "MVP-X: ACCEPTED"
- **Mantenha escopo** estritamente conforme este documento

### üîÑ PATCH - Investiduras: Testemunhas

#### Modelo H√≠brido para Hist√≥ricos

**Objetivo**: Permitir registrar investiduras antigas/legadas quando n√£o for poss√≠vel vincular testemunhas a pessoas/cargos existentes.

#### Estrutura de Dados

```csharp
InvestitureWitness {
    Id,
    InvestitureId,           // FK
    Type,                    // Structured | Text
    MemberId?,               // quando Structured
    RoleSnapshot?,           // quando Structured
    NameText?,               // quando Text (VARCHAR(200))
    RoleText?,               // quando Text (VARCHAR(100))
    OrgText?,                // opcional (VARCHAR(120))
    CreatedAtUtc
}
```

#### Regras de Valida√ß√£o

- **‚â•1 testemunha** obrigat√≥ria
- **Prefer√™ncia**: Structured quando poss√≠vel
- **Fallback texto**: para casos antigos
- **Auto-testemunho**: proibido
- **Aprovador ‚â† Testemunha**: permitido

#### Lideran√ßa - Exig√™ncias Espec√≠ficas

**Investiduras de lideran√ßa** devem conter:

- Pelo menos **uma testemunha** com cargo **"Pastor da Associa√ß√£o"**
- **Fallback**: "Pastor da Uni√£o"
- **Override administrativo**: se nenhum dos dois for vi√°vel

---

## ü©π PATCH ‚Äî Respostas √†s Perguntas P√≥s-MVP0 do Backend

> **Incorpora√ß√£o:** anexar este bloco ao final do arquivo .mdc existente. Todas as decis√µes abaixo s√£o **v√°lidas para o MVP0** salvo indica√ß√£o em contr√°rio.

### 1) Estrutura de Dados para Frontend

**Payload de cria√ß√£o (refer√™ncia):** usar o JSON enviado como _baseline_, por√©m o **MVP0** exige apenas o **m√≠nimo**:

- **Obrigat√≥rios (MVP0):**
  - `firstName`, `lastName`
  - `dateOfBirth` (ISO curto `YYYY-MM-DD`)
  - `cpf` (v√°lido, n√£o duplicado)
  - **Um contato verificado:** `loginInfo.email` **ou** `contacts[0].value` (telefone)
  - `clubId`, `unitId`
  - Aceite de termos/consentimento (quando aplic√°vel)
- **Opcionais (n√£o bloqueiam ativa√ß√£o):**
  - `middleNames`, `socialName`, `rg`
  - `addressInfo` completo
  - contatos adicionais
- **P√≥s-MVP0:** `baptismInfo`, `initialScarfInvestiture` e progresso espiritual.

**Valida√ß√µes:**

- **Frontend:** formato e m√°scaras (CPF, email, telefone, data), obrigatoriedade visual, idade v√°lida, CEP.
- **Backend (autoritativo):** unicidade (CPF/email/telefone), RBAC, consist√™ncia hier√°rquica (clube‚Üíunidade), capacidade de unidade, regras de elegibilidade.

---

### 2) Fluxo de Onboarding

- **Status `Pending`:** exibir **banner** no perfil + **checklist** com itens obrigat√≥rios (‚úÖ completo / ‚è≥ pendente / ‚ùå inv√°lido); cada item navega ao campo.
- **Checklist de ativa√ß√£o:** renderizar como lista clic√°vel; mostrar progresso (%). Ao completar obrigat√≥rios ‚Üí status muda para **Active**.
- **Bloqueios de opera√ß√£o:** mostrar **Dialog**/tooltip padronizado quando a√ß√£o for bloqueada (ex.: "Conclua CPF e contato verificado para continuar") com CTA **"Ir para checklist"**.

---

### 3) Sistema de Eventos

- **Elegibilidade visual:** badge por membro ‚Äî **Eleg√≠vel** (verde), **Pendente** (amarelo), **Ineleg√≠vel** (cinza/vermelho). Filtro r√°pido por elegibilidade.
- **Participa√ß√µes (MVP0):** inscri√ß√£o **simples** (toggle) + **resumo de taxas** (taxa base + opcionais) por membro; cards de totais por unidade/clube.
- **Pagamentos (MVP0):** registrar **inten√ß√£o/compromisso** (sem gateway).
- **Filtros essenciais:** unidade, status (ativo/pendente/ineleg√≠vel), faixa et√°ria, cargo (quando aplic√°vel).

---

### 4) Permiss√µes e Escopo

- **Diretor/Secret√°rio:** veem e gerenciam **apenas membros do pr√≥prio clube** (todas as unidades).
- **Distrital/Regional:** **leitura** de todos os clubes do seu escopo; **sem revelar dados sens√≠veis** individualmente no MVP0.
- **Delega√ß√µes (Regional‚ÜíDistrital):** **fora do MVP0**; entra no **MVP1** com tela de Delega√ß√µes.

---

### 5) UX/UI Espec√≠ficas

- **Dados sens√≠veis ‚Äî "Revelar por 10s":** timer **autom√°tico** com contagem regressiva + a√ß√£o **"Ocultar agora"**; ao expirar, volta a mascarado; **auditoria** (quem, quando, qual campo, id do membro, requestId). Motivo/IP/UA ‚Üí **MVP1**.
- **Confirma√ß√µes:** usar padr√£o global (`useConfirm`) para **exclus√µes**, **convites (enviar/reenviar com cooldown 60s)** e **transfer√™ncia entre unidades**; foco no **Cancelar**, `Esc` cancela, **Enter n√£o confirma**; hard-delete pede **digitar o nome**.
- **Loading states:** **spinners/linear progress** no **MVP0**; **skeleton loading** apenas no **MVP1**.

---

### 6) Integra√ß√£o com Backend

- **Base URL:** via env `VITE_API_BASE_URL` (dev padr√£o: `http://localhost:5258`).
- **CORS (dev):** permitir `http://localhost:5173`; m√©todos `GET,POST,PUT,PATCH,DELETE,OPTIONS`; headers `Content-Type, Authorization, X-Request-Id, Idempotency-Key`; `Credentials: true`.
- **Error handling:**
  - **401** ‚Üí redirect para `/login?next=‚Ä¶`
  - **403** ‚Üí alerta "Permiss√£o insuficiente"
  - **404** ‚Üí placeholder "N√£o encontrado"
  - **409** ‚Üí conflito (ex.: **CPF j√° existe**) com a√ß√£o sugerida (_ver registro_ / _iniciar transfer√™ncia_)
  - **422** ‚Üí exibir **erros por campo** no formul√°rio
  - **429** ‚Üí aviso de rate limit
  - **5xx** ‚Üí toast "Erro inesperado" (log no Sentry a partir do MVP1)

---

### 7) Dados de Teste (Dev)

- **Estrutura hier√°rquica de exemplo:**
  - **Clube A** (idA): **Harpia** (cap 15), **Falc√£o** (cap 15)
  - **Clube B** (idB): **√Åguia** (cap 12)
- **Usu√°rios de teste:**
  - Diretor_ClubeA / `dirA@example.com` / `Passw0rd!`
  - Secretario_ClubeA / `secA@example.com` / `Passw0rd!`
  - Distrital_D1 / `dist1@example.com` / `Passw0rd!` (leitura distrito)
  - Regional_R1 / `reg1@example.com` / `Passw0rd!` (leitura regi√£o)
- **Seed:** ~30 membros variados + 1 evento ativo (taxa base + opcional).

---

### 8) Observa√ß√µes Finais

- **Relat√≥rios CSV (MVP0):** **apenas Diretor do Clube**; Distrital/Regional veem **agregados na UI** (sem dados sens√≠veis individuais).
- **Datas/Timezone:** persistir em **UTC**; exibir em **America/Sao_Paulo**; formato `dd/MM/yyyy` (e `HH:mm` quando aplic√°vel).

---

## üë• Sistema de Membros - MVP0 (Admin-First)

### **Entidades Principais**

- **Member**: Entidade principal com dados pessoais, contatos, endere√ßo, info m√©dica
- **MemberContact**: Contatos m√∫ltiplos (email, telefone, WhatsApp) com verifica√ß√£o
- **MemberAddress**: Endere√ßo completo com valida√ß√£o de CEP
- **MemberMedicalInfo**: Informa√ß√µes m√©dicas (alergias, contato emerg√™ncia)
- **MemberBaptismInfo**: Dados de batismo (data, igreja, pastor)
- **MemberScarfInfo**: Dados de investidura de len√ßo

### **Hierarquia e Agrupamento**

- **HierarchyPath**: Caminho completo Divis√£o ‚Üí Uni√£o ‚Üí Regi√£o ‚Üí Associa√ß√£o ‚Üí Distrito ‚Üí Clube ‚Üí Unidade
- **Agrupamento Flex√≠vel**: Por n√≠vel hier√°rquico, clube, unidade ou lista simples
- **Escopo por Usu√°rio**: Admin v√™ tudo, outros n√≠veis veem apenas seu escopo

### **APIs Implementadas**

- **GET /members**: Lista paginada com filtros e agrupamento
- **GET /members/{id}**: Detalhes do membro
- **POST /members**: Cria√ß√£o de novo membro
- **PUT /members/{id}**: Atualiza√ß√£o de membro
- **DELETE /members/{id}**: Soft delete
- **PATCH /members/{id}/activate**: Ativa√ß√£o
- **PATCH /members/{id}/deactivate**: Desativa√ß√£o
- **POST /members/bulk-action**: A√ß√µes em massa
- **GET /members/export**: Exporta√ß√£o CSV
- **GET /members/stats**: Estat√≠sticas de membros
- **GET /members/hierarchy**: Dados hier√°rquicos para agrupamento
- **POST /members/validate-cpf**: Valida√ß√£o de CPF √∫nico
- **POST /members/validate-email**: Valida√ß√£o de email √∫nico
- **GET /members/unit-suggestions**: Sugest√µes de unidade por idade
- **POST /members/{id}/transfer**: Transfer√™ncia entre clubes
- **GET /members/{id}/transfer-history**: Hist√≥rico de transfer√™ncias

### **Valida√ß√µes e Regras**

- **CPF √önico**: Valida√ß√£o de formato e unicidade
- **Email √önico**: Valida√ß√£o de formato e unicidade
- **Idade M√≠nima**: Valida√ß√£o baseada em data de nascimento
- **Campos Obrigat√≥rios**: Nome, sobrenome, data nascimento, CPF, g√™nero, clube, unidade
- **Contatos Prim√°rios**: Pelo menos um email e um telefone marcados como prim√°rios

### **Filtros e Busca**

- **Busca Textual**: Nome, CPF, email
- **Filtros por Status**: Ativo, Pendente, Inativo, Suspenso
- **Filtros por G√™nero**: Masculino, Feminino, Outro
- **Filtros Hier√°rquicos**: Por divis√£o, uni√£o, regi√£o, associa√ß√£o, distrito, clube, unidade
- **Filtros por Idade**: Faixa et√°ria com slider
- **Filtros por Data**: Per√≠odo de cadastro

### **Performance e Escalabilidade**

- **Pagina√ß√£o**: 20 itens por p√°gina (configur√°vel)
- **√çndices**: CPF, email, clube, unidade, status, data nascimento
- **Cache**: 5 minutos para listas, 10 minutos para dados est√°ticos
- **Lazy Loading**: Carregamento sob demanda de dados hier√°rquicos

---

_Documento atualizado em: $(date)_
_Vers√£o: 2.2_
